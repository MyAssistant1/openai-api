<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flask Ses Kaydı</title>
    <script src="{{ url_for('static', filename='recorder.js') }}"></script>
</head>
<body>
    <h1>Flask Ses Kaydı</h1>
    <button onclick="startRecording()">Kayıt Başlat</button>
    <button onclick="stopRecording()">Kayıt Durdur ve Gönder</button>
    <div id="timer">0:00</div>
    <audio controls id="audioPlayer"></audio>

    <script>
        let recorder;
        let timerInterval;

        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
            .then(stream => {
                recorder = new Recorder(stream);
                recorder.record();
                startTimer();
            })
            .catch(error => {
                console.error('Hata:', error);
            });
        }

        function stopRecording() {
            recorder.stop();
            clearInterval(timerInterval);
            recorder.exportWAV(uploadAudio);
        }

        function startTimer() {
            let seconds = 0;
            timerInterval = setInterval(() => {
                seconds++;
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                document.getElementById('timer').innerText = `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
            }, 1000);
        }

        function uploadAudio(blob) {
            const formData = new FormData();
            formData.append('audio', blob, 'recorded.wav');

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                alert('Kayıt tamamlandı. Sonuç: ' + data.result);
            })
            .catch(error => {
                console.error('Hata:', error);
            });
        }
    </script>
</body>
</html>
